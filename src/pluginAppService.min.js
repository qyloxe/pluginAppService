jQuery(function(){jQuery.pluginAppService=function(b,a){var d={pluginid:-1,urlJSON:"",historyPath:"app",errorPOSTFailure:"Wystąpił błąd w komunikacji z serwerem\nSkontaktuj się z administratorem systemu w celu przekazania informacji o okolicznościach wystąpienia błędu.",vars:{},templates:[],epiceditor:{basePath:"/js/epiceditor",clientSideStorage:false,localStorageName:"epiceditor",parser:marked,file:{name:"epiceditor",defaultContent:"",autoSave:100},theme:{base:"/themes/base/epiceditor.css",preview:"/themes/preview/github.css",editor:"/themes/editor/epic-light.css"},focusOnLoad:false,shortcut:{modifier:18,fullscreen:70,preview:80,edit:79}}};var c=this;init=function(){c.el=b;c.$el=jQuery(b);c.dTemplates={};c.postRender=[];c.lDeferreds=[];Handlebars.registerHelper("add",c.hhAdd);Handlebars.registerHelper("sumRecursive",c.hhSumRecursive);Handlebars.registerHelper("maxRecursiveDate",c.hhMaxRecursiveDate);Handlebars.registerHelper("formatYMDHMS",c.hhFormatYMDHMS);Handlebars.registerHelper("formatYMDHM",c.hhFormatYMDHM);Handlebars.registerHelper("formatYMD",c.hhFormatYMD);Handlebars.registerHelper("formatHMS",c.hhFormatHMS);Handlebars.registerHelper("formatHM",c.hhFormatHM);Handlebars.registerHelper("epicEditor",c.hhEpicEditor);Handlebars.registerHelper("markdown",c.hhMarkdown);Handlebars.registerHelper("ifeq",c.hhIfEQ);Handlebars.registerHelper("ifneq",c.hhIfNEQ);Handlebars.registerHelper("ifge",c.hhIfGE);Handlebars.registerHelper("ifle",c.hhIfLE);Handlebars.registerHelper("ifleq",c.hhIfLEQ);Handlebars.registerHelper("ifgeq",c.hhIfGEQ);c.settings=jQuery.extend({},d,a,c.$el.data("plugin-options"));if(c.settings.templates){c.registerTemplates.call(c,c.settings.templates)}if(c.settings.onInit){c.settings.onInit.call(c)}};c.hhAdd=function(e,f){return e+f};c.hhIfEQ=function(f,g,e){if(f==g){return e.fn(this)}else{return e.inverse(this)}};c.hhIfNEQ=function(f,g,e){if(f!=g){return e.fn(this)}else{return e.inverse(this)}};c.hhIfGE=function(f,g,e){if(f>g){return e.fn(this)}else{return e.inverse(this)}};c.hhIfLE=function(f,g,e){if(f<g){return e.fn(this)}else{return e.inverse(this)}};c.hhIfGEQ=function(f,g,e){if(f>=g){return e.fn(this)}else{return e.inverse(this)}};c.hhIfLEQ=function(f,g,e){if(f<=g){return e.fn(this)}else{return e.inverse(this)}};c.dateToYMD=function(f){var g=f.getDate();var e=f.getMonth()+1;var h=f.getFullYear();return""+h+"-"+(e<=9?"0"+e:e)+"-"+(g<=9?"0"+g:g)};c.dateToHMS=function(f){var i=f.getHours();var e=f.getMinutes();var g=f.getSeconds();return""+(i<=9?"0"+i:i)+":"+(e<=9?"0"+e:e)+":"+(g<=9?"0"+g:g)};c.dateToHM=function(f){var g=f.getHours();var e=f.getMinutes();return""+(g<=9?"0"+g:g)+":"+(e<=9?"0"+e:e)};c.parseDate=function(f){var e=f.split("T");var h=e[0].split("-");var g=e[1].split(":");return new Date(h[0],(h[1]-1),h[2],g[0],g[1],g[2])};c.hhFormatYMDHMS=function(e){var f="-";if(e){var g=c.parseDate(e);f=c.dateToYMD(g)+" "+c.dateToHMS(g)}return f};c.hhFormatYMDHM=function(e){var f="-";if(e){var g=c.parseDate(e);f=c.dateToYMD(g)+" "+c.dateToHM(g)}return f};c.hhFormatYMD=function(e){var f="-";if(e){var g=c.parseDate(e);f=c.dateToYMD(g)}return f};c.hhFormatHMS=function(e){var f="-";if(e){var g=c.parseDate(e);f=c.dateToHMS(g)}return f};c.hhFormatHM=function(e){var f="-";if(e){var g=c.parseDate(e);f=c.dateToHM(g)}return f};c.hhSumRecursive=function(e,f){function g(h){if(!h){return 0}var j=parseInt(h[f]);if(jQuery.isArray(h[e])){for(var k=0;k<h[e].length;k++){j+=g(h[e][k])}}else{if(h[e]){j+=g(h[e])}}return j}return g(this)};c.hhMaxRecursiveDate=function(g,i,e){function j(l,k){if(!l){return k}if(!k){return l}if(l>k){return l}return k}function h(k){var l=undefined;if(!k){return l}if(k[i]){var l=c.parseDate(k[i])}if(jQuery.isArray(k[g])){for(var m=0;m<k[g].length;m++){l=j(l,h(k[g][m]))}}else{if(k[g]){l=j(l,h(k[g]))}}return l}var f=h(this);if(f){return c.hhFormatYMDHMS(f)}if(!e){e=""}return e};c.hhEpicEditor=function(e,f){var g="";if(f.hash["class"]){g=' class="'+f.hash["class"]+'"'}c.postRender.push(function(){var h=c.createEpicEditor(e);if(f.hash.text){h.importFile("markdown",f.hash.text)}});return new Handlebars.SafeString("<div"+g+' id="'+e+'"></div>')};c.hhMarkdown=function(e){var f="";if(e){f=marked(e)}return new Handlebars.SafeString(f)};c.createEpicEditor=function(e){var g=jQuery.extend({},c.settings.epiceditor,{container:e});var f=new EpicEditor(g);f.load();jQuery("#"+e).data("epiceditor",f);return f};c.registerTemplate=function(e){return jQuery.ajax({url:"PLUGIN_TEMPLATE_"+c.settings.pluginid+"_"+e+".asp",async:true,success:function(f){f="\n<!-- TEMPLATE START: "+e+" -->\n"+f+"\n<!-- TEMPLATE END: "+e+" -->\n";template=Handlebars.compile(f);c.dTemplates[e]=template;Handlebars.registerPartial(e,template)}})};c.registerTemplates=function(e){jQuery.map(e,function(h,g){var f=c.registerTemplate(h);c.lDeferreds.push(f)})};c.registerClickEvent=function(f,e,g){if(arguments.length==2){g=e;e=function(){return{}}}c["_do"+f]=g;c["_cl"+f]=function(h,i){if(h){jQuery('[data-toggle="dropdown"]').parent().removeClass("open")}var j=e.call(this,h);if(typeof j==="undefined"){j={}}if(j!=false){j.m=f;j=jQuery.extend(j,i);if(j.noHistory){c["_do"+f].call(c,j)}else{jQuery.address.value(c.settings.historyPath+"?"+jQuery.param(j))}}return false};jQuery(c.el).delegate("."+f,"click",c["_cl"+f])};c.renderHTMLTemplate=function(g,e,h,j){var f=c.dTemplates[e];c.postRender=[];if(!f){f=Handlebars.compile(jQuery(e).html())}var i=f(g);h.html(i);jQuery.map(c.postRender,function(l,k){l.call(c)});c.postRender=[];if(j){j.call(this,g)}};c.renderXMLTemplate=function(g,e,f,h){return jQuery.get(c.settings.urlJSON,g,function(j){var i=jQuery.xml2json(j);c.renderHTMLTemplate(i,e,f);if(h){h.call(this,i)}},"html")};c.renderJSONTemplate=function(g,e,f,h){return jQuery.get(c.settings.urlJSON,g,function(i){c.renderHTMLTemplate(i,e,f);if(h){h.call(this,i)}},"json")};c.callEvent=function(e,f,g){c["_cl"+e].call(this,f,g)};jQuery.address.change(function(g){if(jQuery.isEmptyObject(g.parameters)){return false}var e=g.parameters.m;var f=g.path;if(f=="/"+c.settings.historyPath){c["_do"+g.parameters.m].call(c,g.parameters)}return false});c.postData=function(g,e,f){if(!f){f=function(h,j,i){alert(c.settings.errorPOSTFailure)}}return jQuery.ajax({type:"POST",url:c.settings.urlJSON,cache:false,data:g,success:function(i,j,h){if(!i){f.call(this,h,j)}else{e.call(this,i,j,h)}},error:f,dataType:"json"})};init();c.registerClickEvent("evBack",function(e){window.history.go(-2)});jQuery.when.apply(c,c.lDeferreds).then(function(){if(c.settings.onStart){c.settings.onStart.call(c)}})}});